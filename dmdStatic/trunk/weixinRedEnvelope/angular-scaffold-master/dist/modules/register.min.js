/*! weixin - v0.1.0 - 2014-07-21
* Copyright (c) 2014 lovemoon@yeah.net; Licensed GPLv2 */
!function(){var a=angular.module("app",["ui.router","ui.bootstrap","angular-growl","templates","homeModule","registerModule","decorateModule"]);angular.element(document).ready(function(){angular.bootstrap(document,["app"])}),a.config(["$httpProvider",function(a){a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded;charset=utf-8",a.defaults.transformRequest=[function(a){return angular.isObject(a)&&"[object File]"!==String(a)?b(a):a}],a.interceptors.push(["$q","growl",function(a,b){return{request:function(b){var c=b.url.match(/:(\w+)/g);return null!==c&&angular.forEach(c,function(a){var c=a.substring(1);b.params&&b.params.hasOwnProperty(c)?(b.url=b.url.replace(a,b.params[c]),delete b.params[c]):b.data&&b.data.hasOwnProperty(c)&&(b.url=b.url.replace(a,b.data[c]),delete b.data[c])}),a.when(b)},response:function(b){if(b.config.parsing!==!1&&200===b.status&&angular.isObject(b.data)){var c=b.data;return c.data=c.data||{},(c.data.message||c.message)&&(c.data.message=c.data.message||c.message),-1!==[0,200].indexOf(c.code)?c.data:a.reject(c.data)}return a.when(b)},requestError:function(c){return b.addErrorMessage("请求异常，请刷新重试！",{ttl:-1}),a.reject(c)},responseError:function(c){return b.addErrorMessage("服务器异常，请刷新重试！",{ttl:-1}),a.reject(c)}}}])}]),a.config(["paginationConfig",function(a){a.directionLinks=!1,a.boundaryLinks=!0,a.maxSize=10,a.firstText="«",a.lastText="»"}]),a.config(["growlProvider",function(a){a.onlyUniqueMessages(!0),a.globalTimeToLive(4e3),a.globalEnableHtml(!1)}]),a.run(["$rootScope",function(a){a.$on("$stateChangeSuccess",function(b,c){a.isHome="home"===c.name})}]),a.directive("csFocus",["$timeout",function(a){return{restrict:"A",replace:!1,link:function(b,c){var d=0;!function e(){c.is(":visible")?c.focus():d++<1&&a(e,200)}()}}}]),a.directive("csNumber",function(){return{restrict:"A",replace:!1,link:function(a,b){b.on("focus",function(){this.type="number"}).on("blur",function(){this.type="text"})}}}),a.directive("csBottom",["$window","$document",function(a,b){return{restrict:"A",replace:!1,link:function(c,d){var e=function(){d.toggleClass("keep-bottom",window.innerHeight>=b.height())},f=function(a){var b=["datetime","datetime-local","email","month","number","range","search","tel","time","url","week"].indexOf(a.target.type);d.hasClass("keep-bottom")&&("TEXTAREA"===a.target.tagName||b)&&d.hide()},g=function(){d.show()};b.on("focus","input,textarea",f),b.on("blur","input,textarea",g),angular.element(a).on("resize",e).resize(),d.on("$destroy",function(){angular.element(a).off("resize",e),b.off("focus","input,textarea",f),b.off("blur","input,textarea",g)})}}}]),a.directive("csThumbnail",["$window",function(a){var b={support:!(!a.FileReader||!a.CanvasRenderingContext2D),isFile:function(b){return angular.isObject(b)&&b instanceof a.File},isImage:function(a){var b="|"+a.type.slice(a.type.lastIndexOf("/")+1)+"|";return-1!=="|jpg|png|jpeg|bmp|gif|".indexOf(b)}};return{restrict:"A",template:"<canvas />",link:function(a,c,d){if(b.support){var e=a.$eval(d.csThumbnail);if(b.isFile(e.file)&&b.isImage(e.file)){var f=c.find("canvas"),g=new FileReader;g.onload=function(a){var b=new Image;b.onload=function(){var a=e.width||this.width/this.height*e.height,b=e.height||this.height/this.width*e.width;f.attr({width:a,height:b}),f[0].getContext("2d").drawImage(this,0,0,a,b)},b.src=a.target.result},g.readAsDataURL(e.file)}}}}}]),a.directive("csLayout",[function(){return{restrict:"A",replace:!1,transclude:!0,templateUrl:"common/templates/layout.partials.html",link:function(){}}}]),function(){var b=62,c=null;a.directive("csSquare",["$window",function(a){return{restrict:"A",replace:!1,link:function(d,e){var f=function(){null===c&&(c=Math.max((e.width()-b)/2,0)+"px 0"),e.css("padding",c)};angular.element(a).on("resize",function(){c=null,f()}).triggerHandler("resize")}}}])}(),a.filter("group",function(){return function(a,b){if(!a)return a;if(a.$rows){for(var c=[],d=0;d<a.$rows.length;d++)c=c.concat(a.$rows[d]);if(c.length!==a.length)delete a.$rows;else for(var e=0;e<a.length;e++)if(a[e]!==c[e]){delete a.$rows;break}}if(!a.$rows){for(var f=[],g=0;g<a.length;g++)g%b===0&&f.push([]),f[f.length-1].push(a[g]);a.$rows=f}return a.$rows}}),a.filter("empty",function(){return function(a){return!a||angular.equals({},a)||angular.equals([],a)}}),a.filter("min",function(){return function(a,b){return Math.min(a,b)}}),a.filter("max",function(){return function(a,b){return Math.max(a,b)}}),function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}(),function(){"function"!=typeof Array.prototype.indexOf&&(Array.prototype.indexOf=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return b;return-1}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")})}(),function(){var a=function(){var a=3,b=document.createElement("div"),c=b.getElementsByTagName("i");do b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->";while(c[0]);return a>4?a:!1}();if(a){var b=0;!function c(){var d=document.getElementsByTagName("html")[0];d?d.className+=" ie ie"+a:b++<2&&setTimeout(c,200)}()}}();var b=function(a){var c,d,e,f,g,h,i,j="";for(c in a)if(a.hasOwnProperty(c))if(d=a[c],d instanceof Array)for(i=0;i<d.length;++i)g=d[i],e=c+"["+i+"]",h={},h[e]=g,j+=b(h)+"&";else if(d instanceof Object)for(f in d)d.hasOwnProperty(f)&&(g=d[f],e=c+"["+f+"]",h={},h[e]=g,j+=b(h)+"&");else void 0!==d&&null!==d&&(j+=encodeURIComponent(c)+"="+encodeURIComponent(d)+"&");return j.length?j.substr(0,j.length-1):j},c=angular.module("decorateModule",["ui.router","ui.bootstrap"]);c.config(["$stateProvider","$urlRouterProvider",function(a,b){b.when("/decorate","/decorate/houses"),a.state("decorate",{"abstract":!0,url:"/decorate",templateUrl:"modules/decorate/templates/decorate.html"}).state("decorate.houses",{url:"/houses",controller:"housesController",templateUrl:"modules/decorate/templates/houses.html"}).state("decorate.invitation",{url:"/invitation/{houseId:[0-9]+}",controller:"invitationController",templateUrl:"modules/decorate/templates/invitation.html"}).state("decorate.reference",{url:"/reference",controller:"referenceController",templateUrl:"modules/decorate/templates/reference.html"}).state("decorate.history",{url:"/history",controller:"historyController",templateUrl:"modules/decorate/templates/history.html"}).state("decorate.progress",{url:"/progress/{decorateId:[0-9]+}",controller:"progressController",templateUrl:"modules/decorate/templates/progress.html"}).state("decorate.drawing",{url:"/drawing/{decorateId:[0-9]+}",controller:"drawingController",templateUrl:"modules/decorate/templates/drawing.html"}).state("decorate.confirm",{url:"/confirm/{decorateId:[0-9]+}",controller:"confirmController",templateUrl:"modules/decorate/templates/confirm.html"}).state("decorate.acceptance",{url:"/acceptance/{decorateId:[0-9]+}",controller:"acceptanceController",templateUrl:"modules/decorate/templates/acceptance.html"}).state("decorate.refund",{url:"/refund/{decorateId:[0-9]+}",controller:"refundController",templateUrl:"modules/decorate/templates/refund.html"}).state("decorate.notice",{"abstract":!0,url:"/notice",template:'<div class="notice" ui-view></div>'}).state("decorate.notice.initiate",{url:"/initiate/{decorateId:[0-9]+}",controller:"noticeController",templateUrl:"modules/decorate/templates/notice-initiate.html"}).state("decorate.notice.drawing",{url:"/drawing/{decorateId:[0-9]+}",controller:"noticeController",templateUrl:"modules/decorate/templates/notice-drawing.html"}).state("decorate.notice.acceptance",{url:"/acceptance/{decorateId:[0-9]+}",controller:"noticeController",templateUrl:"modules/decorate/templates/notice-acceptance.html"}).state("decorate.notice.refund",{url:"/refund/{decorateId:[0-9]+}",controller:"noticeController",templateUrl:"modules/decorate/templates/notice-refund.html"})}]);var d=angular.module("homeModule",["ui.router","ui.bootstrap"]);d.config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/home"),a.state("home",{url:"/home",controller:"homeController",templateUrl:"modules/home/templates/home.html"}).state("config",{url:"/config",controller:"configController",templateUrl:"modules/home/templates/config.html"})}]);var e=angular.module("registerModule",["ui.router","ui.bootstrap"]);e.config(["$stateProvider","$urlRouterProvider",function(a,b){b.when("/register","/register/mobile"),a.state("register",{"abstract":!0,url:"/register",templateUrl:"modules/register/templates/register.html"}).state("register.mobile",{url:"/mobile",controller:"mobileController",templateUrl:"modules/register/templates/mobile.html"}).state("register.captcha",{url:"/verify",controller:"captchaController",templateUrl:"modules/register/templates/captcha.html"}).state("register.success",{url:"/success",controller:"successController",templateUrl:"modules/register/templates/success.html"})}]),e.controller("mobileController",["$scope","$state","registerService",function(a,b,c){a.submit=function(){c.sendMobile().then(function(){b.go("register.captcha")},function(){})}}]),e.controller("captchaController",["$scope","$state","$timeout","registerService",function(a,b,c,d){a.submit=function(){a.processing=!0,d.sendCaptcha().then(function(){b.go("register.success")},function(){a.message="验证码输入有误，请重新输入！"})["finally"](function(){a.submitText="重新验证",a.processing=!1})};var e=null,f=function(){c.cancel(e),a.resend=!1,a.remaining=5,g()},g=function(){e=c(function(){a.remaining-=1,0===a.remaining?a.resend=!0:g()},1e3)};f(),a.refresh=function(){d.sendFresh().then(function(){f()})},a.$on("$destroy",function(){c.cancel(e)})}]),e.controller("successController",["$scope","$state","registerService",function(){}]),e.factory("registerService",["$http",function(a){return{sendMobile:function(){return a({url:"interface/register/success.json",method:"post"})},sendCaptcha:function(){return a({url:"interface/register/success.json",method:"post"})},sendFresh:function(){return a({url:"interface/register/success.json",method:"post"})}}}]),angular.module("templates",["common/templates/layout.partials.html","modules/register/templates/captcha.html","modules/register/templates/failure.html","modules/register/templates/mobile.html","modules/register/templates/register.html","modules/register/templates/success.html"]),angular.module("common/templates/layout.partials.html",[]).run(["$templateCache",function(a){a.put("common/templates/layout.partials.html","<div ui-view></div>")}]),angular.module("modules/register/templates/captcha.html",[]).run(["$templateCache",function(a){a.put("modules/register/templates/captcha.html",'<form role="form" name="captchaForm" ng-submit="submit()" autocomplete="false">\n  <div class="form-group form-group-first">\n    <input type="text" name="captcha" ng-model="captcha" class="form-control" id="inputCapcha" placeholder="请输入验证码" cs-number cs-focus required ng-pattern="/^\\d{4,8}$/" ng-if="!message" />\n  </div>\n  <div class="form-group form-group-first has-error" ng-if="message" ng-click="$parent.message=\'\'">\n    <input type="text" name="message" ng-model="message" class="form-control no-bg" readonly />\n  </div>\n  <div class="form-group">\n    <button type="submit" class="btn btn-primary full-width" ng-disabled="captchaForm.$invalid || processing">\n      <span ng-hide="processing">{{ submitText || \'注册账号\' }}</span><span ng-show="processing">请稍后...</span>\n    </button>\n  </div>\n  <div class="form-group">\n    <small ng-if="!resend">{{ remaining }}秒后可重新发送</small>\n    <a ng-if="resend" class="small" ng-click="refresh()">重发验证码</a>\n  </div>\n</form>')}]),angular.module("modules/register/templates/failure.html",[]).run(["$templateCache",function(a){a.put("modules/register/templates/failure.html",'<p class="text-center text-danger mg-vt-30">验证码输入有误，请重新输入！</p>\n<a ui-sref="register.captcha" class="btn btn-primary full-width">重新验证</a>')}]),angular.module("modules/register/templates/mobile.html",[]).run(["$templateCache",function(a){a.put("modules/register/templates/mobile.html",'<form role="form" name="mobileForm" ng-submit="submit()">\n  <div class="form-group form-group-first">\n    <input type="text" name="mobile" ng-model="mobile" class="form-control" id="inputMobile" placeholder="请输入手机号码" cs-number required ng-pattern="/^\\d{11}$/" />\n  </div>\n  <div class="form-group">\n    <button type="submit" class="btn btn-primary full-width" ng-disabled="mobileForm.$invalid">获取验证码</button>\n  </div>\n</form>')}]),angular.module("modules/register/templates/register.html",[]).run(["$templateCache",function(a){a.put("modules/register/templates/register.html",'<div id="register">\n  <div class="container-fluid">\n    <div class="row">\n      <div class="col-xs-12 col-sm-12" ui-view></div>\n    </div>\n  </div>\n</div>')}]),angular.module("modules/register/templates/success.html",[]).run(["$templateCache",function(a){a.put("modules/register/templates/success.html",'<p class="text-center mg-vt-30">恭喜你，注册成功！</p>\n<a href="" class="btn btn-primary full-width">立即完善资料</a>\n\n<p class="text-center mg-vt-15">\n  <a href="#/home">返回我的管家</a>\n</p>')}])}();